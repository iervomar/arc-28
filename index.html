<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Buon Compleanno ☕</title>

<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    background: #fff6ec;
    font-family: system-ui, -apple-system, sans-serif;
    color: #4a3b2a;
    text-align: center;
    overflow: hidden;
  }

  button {
    border: none;
    border-radius: 999px;
    padding: 14px 26px;
    font-size: 16px;
    background: #d6a75c;
    color: white;
    cursor: pointer;
  }

  .screen {
    position: absolute;
    inset: 0;
    display: none;
    padding: 20px;
  }

  .screen.active {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .title {
    font-size: 26px;
    margin-bottom: 20px;
  }

  .reset {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 12px;
    background: transparent;
    color: #a78b6d;
  }

  /* --- MOKA SVG --- */
  svg {
    width: 200px;
    height: auto;
  }

  #water {
    transition: height 0.1s;
  }

  /* --- REVEAL --- */
  .reveal img {
    width: 200px;
    filter: blur(20px);
    transition: filter 1s;
  }

  .reveal.show img {
    filter: blur(20px); /* livello 1 */
  }
</style>
</head>

<body>

<button class="reset" onclick="resetGame()">Ricomincia</button>

<!-- START SCREEN -->
<div id="start" class="screen active">
  <div class="title">☕ Qualcosa sta per essere preparato…</div>
  <button onclick="startGame()">Inizia</button>
</div>

<!-- LEVEL 1 -->
<div id="level1" class="screen">
  <svg viewBox="0 0 200 300">
    <!-- Corpo moka -->
    <rect x="40" y="40" width="120" height="200" rx="20" fill="#ddd"/>

    <!-- Interno -->
    <rect x="60" y="60" width="80" height="160" rx="10" fill="#f5f5f5"/>

    <!-- Acqua -->
    <rect id="water" x="60" y="220" width="80" height="0" rx="10" fill="#8ecae6"/>

    <!-- Linea livello -->
    <line x1="60" y1="140" x2="140" y2="140"
          stroke="#c19a6b" stroke-dasharray="4"/>
  </svg>
</div>

<!-- REVEAL -->
<div id="reveal1" class="screen reveal">
  <img src="nanopresso.jpg" alt="Nanopresso"/>
  <div style="margin-top:20px;">Qualcosa prende forma…</div>
  <button style="margin-top:20px;">Continua</button>
</div>

<script>
let level = parseInt(localStorage.getItem("mokaLevel")) || 0;
let filling = false;
let waterHeight = 0;
let interval;

const water = document.getElementById("water");

function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function startGame() {
  level = 1;
  localStorage.setItem("mokaLevel", level);
  show("level1");
}

function resetGame() {
  localStorage.removeItem("mokaLevel");
  location.reload();
}

/* --- LEVEL 1 LOGIC --- */
function startFilling() {
  filling = true;
  interval = setInterval(() => {
    if (waterHeight < 160) {
      waterHeight += 1.5;
      water.setAttribute("y", 220 - waterHeight);
      water.setAttribute("height", waterHeight);
    }
  }, 16);
}

function stopFilling() {
  filling = false;
  clearInterval(interval);

  // zona successo: circa linea centrale
  if (waterHeight > 70 && waterHeight < 100) {
    setTimeout(() => {
      localStorage.setItem("mokaLevel", 2);
      show("reveal1");
    }, 400);
  }
}

/* TOUCH EVENTS */
const level1 = document.getElementById("level1");
level1.addEventListener("touchstart", startFilling);
level1.addEventListener("touchend", stopFilling);

/* RESUME */
if (level === 1) show("level1");
</script>

</body>
</html>
