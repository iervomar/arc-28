<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Qualcosa sta per essere preparato ☕</title>

<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    background: #fff6ec;
    font-family: system-ui, -apple-system, sans-serif;
    color: #4a3b2a;
    text-align: center;
    overflow: hidden;
  }

  /* ---- RESET BUTTON ---- */
  .reset {
    position: fixed;
    top: 14px;
    right: 14px;
    z-index: 999;
    font-size: 13px;
    padding: 8px 14px;
    border-radius: 999px;
    background: #e6cfa7;
    color: #4a3b2a;
    border: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    cursor: pointer;
  }

  .reset:active {
    transform: scale(0.95);
  }

  /* ---- SCREENS ---- */
  .screen {
    position: absolute;
    inset: 0;
    display: none;
    padding: 24px;
  }

  .screen.active {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .title {
    font-size: 24px;
    margin-bottom: 28px;
  }

  button.main {
    border: none;
    border-radius: 999px;
    padding: 16px 30px;
    font-size: 17px;
    background: #d6a75c;
    color: white;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }

  svg {
    width: 260px;
    height: auto;
  }
</style>
</head>

<body>

<button class="reset" onclick="resetGame()">Ricomincia</button>

<!-- START SCREEN -->
<div id="start" class="screen active">
  <div class="title">☕ Qualcosa sta per essere preparato…</div>
  <button class="main" onclick="startGame()">Inizia</button>
</div>

<!-- LEVEL 1 -->
<div id="level1" class="screen">

  <svg viewBox="0 0 200 260">

    <!-- BASE -->
    <path d="M50 140 L150 140 L135 240 L65 240 Z"
          fill="none" stroke="#333" stroke-width="3"/>

    <!-- WATER -->
    <rect id="water"
          x="65" y="240" width="70" height="0"
          fill="#b7def3"/>

    <!-- UPPER PART (REFERENCE ONLY) -->
    <path d="M60 40 L140 40 L155 140 L45 140 Z"
          fill="none" stroke="#333" stroke-width="3"/>

    <!-- LEVEL LINE -->
    <line x1="65" y1="175" x2="135" y2="175"
          stroke="#999" stroke-dasharray="5"/>

  </svg>

</div>

<script>
/* ===============================
   GLOBAL STATE
=============================== */
let level = parseInt(localStorage.getItem("mokaLevel")) || 0;

/* ===============================
   UTILITIES
=============================== */
function show(screenId) {
  document.querySelectorAll(".screen")
    .forEach(s => s.classList.remove("active"));
  document.getElementById(screenId).classList.add("active");
}

function resetGame() {
  localStorage.clear();
  show("start");
  resetLevel1();
}

/* ===============================
   START
=============================== */
function startGame() {
  localStorage.setItem("mokaLevel", 1);
  show("level1");
}

/* ===============================
   LEVEL 1 – TAP TO FILL WATER
=============================== */
const water = document.getElementById("water");
let waterHeight = 0;

function resetLevel1() {
  waterHeight = 0;
  water.setAttribute("height", 0);
  water.setAttribute("y", 240);
}

function tapWater() {
  if (waterHeight >= 90) return;

  waterHeight += 6;
  water.setAttribute("height", waterHeight);
  water.setAttribute("y", 240 - waterHeight);

  // SUCCESS ZONE
  if (waterHeight >= 55 && waterHeight <= 70) {
    setTimeout(() => {
      localStorage.setItem("mokaLevel", 2);
      alert("Perfetto ☕"); // placeholder feedback
      resetLevel1();
      show("start"); // per ora torniamo allo start
    }, 300);
  }
}

const level1Screen = document.getElementById("level1");
level1Screen.addEventListener("touchstart", tapWater);
level1Screen.addEventListener("click", tapWater);

/* ===============================
   RESUME LOGIC
=============================== */
if (level === 1) {
  show("level1");
} else {
  show("start");
}
</script>

</body>
</html>
